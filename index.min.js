console.log("Bifrost Loaded -",window.location.href);class BifrostCors{constructor(e,t=!1,s){var o;(this.bifrostResponse,this.address=e,this.socketListner,this.bifrostBridge=bifrostBridge.bind(this),this.promiseConstructor=promiseConstructor.bind(this),this.postbackLocalstorage=postbackLocalstorage.bind(this),this.postbackSetLocalstorage=postbackSetLocalstorage.bind(this),this.postbackDeleteLocalstorage=postbackDeleteLocalstorage.bind(this),this.postbackGetCookie=postbackGetCookie.bind(this),this.postbackSetCookie=postbackSetCookie.bind(this),this.postbackRunEval=postbackRunEval.bind(this),this.postbackDomManipulationId=postbackDomManipulationId.bind(this),this.postbackDomManipulationClass=postbackDomManipulationClass.bind(this),this.startMessageThread=startMessageThread.bind(this),this.handleSocketMessage=handleSocketMessage.bind(this),t&&(this.midgard=document.getElementById(s)),!1===t)&&((o=document.createElement("iframe")).setAttribute("id","bifrost-cors"),o.setAttribute("width","0px"),o.setAttribute("height","0px"),o.setAttribute("style","position:absolute; top: -999px; display: none"),o.setAttribute("src",this.address),document.body.appendChild(o),this.midgard=document.getElementById("bifrost-cors"));window.addEventListener("message",e=>{if(e.origin===this.address){if(e.data.type.includes("request")){let t=e.data.type.replace("request","postback").replace(/-/g,"_");this.heimdall(t,e.data.value)}"bifrost-socket-message"===e.data.type&&(this.socketListner?(this.bifrostBridge("bifrost-response",!0,!0),this.socketListner(e.data.value)):(console.group("Error - Bifrost-Cors"),console.error("Message Thread not init -- Bifrost-Cors"),console.log("You.developer ? dig into lib at line 37 : Raise a issue"),console.groupEnd()))}})}async getLocalStorage(e){return this.heimdall("get_localstorage",e),this.heimdall("get_response"),await this.bifrostResponse}async setLocalStorage(e){return this.heimdall("set_localstorage",e),this.heimdall("get_response"),await this.bifrostResponse}async deleteLocalStorage(e){return this.heimdall("delete_localstorage",e),this.heimdall("get_response"),await this.bifrostResponse}async getCookie(e){return this.heimdall("get_cookie",e),this.heimdall("get_response"),await this.bifrostResponse}async setCookie(e,t,s){let o=[e,t,s];return this.heimdall("set_cookie",o),this.heimdall("get_response"),await this.bifrostResponse}async runExpression(e){return this.heimdall("run_eval",e),this.heimdall("get_response"),await this.bifrostResponse}async domManipulationById(e,t){let s=[e,t];return this.heimdall("dom_manipulation_id",s),this.heimdall("get_response"),await this.bifrostResponse}async domManipulationByClass(e,t,s){let o=[e,t,s];return this.heimdall("dom_manipulation_class",o),this.heimdall("get_response"),await this.bifrostResponse}async requestMessageThread(e){return this.heimdall("start_message_thread",e),!!this.socketListner}async send(e){return this.heimdall("bifrost_socket_send_message",e),this.heimdall("get_response"),await this.bifrostResponse}heimdall(e,t){switch(e){case"get_response":this.promiseConstructor("bifrost-response");break;case"get_localstorage":this.bifrostBridge("request-get-localstorage",t);break;case"set_localstorage":this.bifrostBridge("request-set-localstorage",t);break;case"delete_localstorage":this.bifrostBridge("request-delete-localstorage",t);break;case"get_cookie":this.bifrostBridge("request-get-cookie",t);break;case"set_cookie":this.bifrostBridge("request-set-cookie",t);break;case"run_eval":this.bifrostBridge("request-run-eval",t);break;case"dom_manipulation_id":this.bifrostBridge("request-dom-manipulation-id",t);break;case"dom_manipulation_class":this.bifrostBridge("request-dom-manipulation-class",t);break;case"postback_get_localstorage":this.postbackLocalstorage(t);break;case"postback_set_localstorage":this.postbackSetLocalstorage(t);break;case"postback_delete_localstorage":this.postbackDeleteLocalstorage(t);break;case"postback_get_cookie":this.postbackGetCookie(t);break;case"postback_set_cookie":this.postbackSetCookie(t);break;case"postback_run_eval":this.postbackRunEval(t);break;case"postback_dom_manipulation_id":this.postbackDomManipulationId(t);break;case"postback_dom_manipulation_class":this.postbackDomManipulationClass(t);break;case"start_message_thread":this.startMessageThread(t);break;case"bifrost_socket_send_message":this.handleSocketMessage(t)}}}function bifrostBridge(e,t,s=!1){let o={type:e,value:t};s?window.parent.postMessage(o,"*"):this.midgard&&this.midgard.contentWindow.postMessage(o,"*")}function promiseConstructor(e){return this.bifrostResponse=new Promise((t,s)=>{window.addEventListener("message",s=>{s.origin===this.address&&s.data.type&&s.data.type===e&&t(s.data.value)})}),this.bifrostResponse}function postbackLocalstorage(e){if("object"==typeof e){let t=[];e.map(e=>{t.push(localStorage.getItem(e))}),this.bifrostBridge("bifrost-response",t,!0)}else{let t=localStorage.getItem(e);this.bifrostBridge("bifrost-response",t,!0)}}function postbackSetLocalstorage(e){localStorage.setItem(e.key,e.value),localStorage.getItem(e.key),this.bifrostBridge("bifrost-response",!0,!0)}function postbackDeleteLocalstorage(e){"object"==typeof e?(e.map(e=>{localStorage.removeItem(e)}),this.bifrostBridge("bifrost-response",!0,!0)):(localStorage.removeItem(e),this.bifrostBridge("bifrost-response",!0,!0))}function postbackGetCookie(e){let t=document.cookie.split(";"),s={};for(var o=0;o<t.length;o++){let e=t[o].split("=");s[(e[0]+"").trim()]=unescape(e[1])}if(e){let t=s[e];this.bifrostBridge("bifrost-response",t,!0)}else{let e=s;this.bifrostBridge("bifrost-response",e,!0)}}function postbackSetCookie(e){let t=e[0],s=e[1],o=e[2],i="";if(o){let e=new Date;e.setTime(e.getTime()+24*o*60*60*1e3),i="; expires="+e.toUTCString()}document.cookie=t+"="+(s||"")+i+"; path=/",this.bifrostBridge("bifrost-response",!0,!0)}function postbackRunEval(payload){let data=eval(payload);this.bifrostBridge("bifrost-response",data,!0)}function postbackDomManipulationId(e){let t=e[0],s=e[1],o=document.getElementById(t).style;Object.keys(s).map(e=>{o[e]=s[e]}),this.bifrostBridge("bifrost-response",!0,!0)}function postbackDomManipulationClass(e){let t=e[0],s=e[1],o=e[2],i=document.getElementsByClassName(t)[s].style;Object.keys(o).map(e=>{i[e]=o[e]}),this.bifrostBridge("bifrost-response",!0,!0)}function startMessageThread(e){this.socketListner=e,this.bifrostBridge("bifrost-response",!0,!0)}function handleSocketMessage(e){this.bifrostBridge("bifrost-socket-message",e,Boolean(!this.midgard))}export default BifrostCors;